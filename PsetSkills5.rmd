---
title: "skills_ps_5"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(forcats)
library(dplyr)
library(ggplot2)
library(naniar)
library(lubridate)
library(nycflights13)


levels(gss_cat$rincome)
```

1.1



```{r}

ggplot(gss_cat,aes(x=rincome))+
geom_bar()+
coord_flip()
```

The prolem is that the categorial variable is not ordered.  this can be fixed by using fct_infreq():




One way to fix it 

```{r}
ggplot(gss_cat, aes(x = fct_infreq(rincome))) + 
  geom_bar() + 
  coord_flip()
```
1.2

  
```{r}
gss_cat %>%
  mutate(lump = fct_lump(rincome, n = 5)) %>%
  ggplot(aes(x=fct_infreq(lump)))+
  geom_bar()+ 
  coord_flip()


levels(rincome)
```
1.3.a



```{r}

gss_cat
ggplot(gss_cat, aes(x = (tvhours))) + 
  geom_bar() + 
  coord_flip()
```


```{r}

```




```{r}
ggplot(gss_cat, mapping = aes(x=relig, y=tvhours))+
    geom_boxplot()+ 
    theme(axis.text.x=element_text(angle=-45))
```
We consider the number outliers that are above 18 hours to be suspect as normal people need to sleep.  it might make sens to remove these.






```{r}

```





This 
option 3: winsorize


option 1: drop
The problem is that this removes the data and it is possible that we want to us it later. 

```{r}

relig_summary <- gss_cat %>%
  group_by(relig) %>%
  filter(tvhours<=18) %>% 
  summarise(
    tvhours = mean(tvhours, na.rm = TRUE),
    n = n()
  )
ggplot(relig_summary, aes(tvhours, fct_reorder(relig,tvhours))) + geom_point()

```
option 2: set missing

```{r}
install.packages("naniar")
library(naniar)
relig_summary <- gss_cat %>%
  replace_with_na(replace=list(gss_cat$tvhours>=18))%>%
  group_by(relig) %>%
  summarise(
    age = mean(age, na.rm = TRUE),
    tvhours = mean(tvhours, na.rm = TRUE),
    n = n()
  )
ggplot(relig_summary, aes(tvhours, fct_reorder(relig,tvhours))) + geom_point()

```
Dont know what winsorize means


1.3.c





```{r}



relig_summary <- gss_cat %>%
  group_by(relig) %>%
  summarise(
    tvhours_mean = mean(tvhours, na.rm = TRUE),
    error = qt(0.975,df=length(tvhours)-1)*sd(tvhours,na.rm=TRUE)/sqrt(length(tvhours)),
    LOWER95=mean(tvhours,na.rm=TRUE)-error,
    HIGHER95 =mean(tvhours, na.rm=TRUE)+error,
    n = n()
  )

relig_summary

ggplot(relig_summary)+
  
      geom_linerange(mapping=aes(x=relig,ymin=LOWER95,ymax=HIGHER95), colour='black') +
      geom_point(mapping=aes(x=relig,y=tvhours_mean))+
      theme(axis.text.x=element_text(angle=-45))

```
2.1
```{r}
d1 <- "123-Apr-03"
d2 <- "06-Jun-2017"
d3 <- "12/29/14" # Dec 29, 2014
d4 <- "November 20, 1909"
d5 <- c("January 2 (2016)", "January 2 (2018)")


parse_date_time(d1, "%y-m-d") # cannot find a way to work it 
parse_date_time(d2, "%d%m%y")
parse_date_time(d3, "%m%d%y")
parse_date_time(d4, "%m%d%y")

parse_date_time(d5, "%m%d%y")
```
2.2 

Seventh day of every month in 2012
```{r}
x <- seq.Date(from=as.Date("2012-01-7"), to=as.Date("2012-12-31"), by="month")

weekdays((x))
```
fifth day of every month in 2020:

```{r}
weekdays(seq.Date(from=as.Date("2012-01-5"), to=as.Date("2012-12-31"), by="month"))
```


2.3.1
```{r}
flights %>% 
  mutate(dep_diff=dep_time-sched_dep_time-dep_delay) %>% 
  mutate(dep_date=ISOdate(year,month,day)) %>%
  ggplot(aes(x=dep_date,y=dep_diff)) +
  geom_point()+
  ylim(-100,100)
  


```
There is often a difference, Why I dont know.  The difference is -40, 40, 80

2.3.2


  
  
  
```{r}

  spring=ISOdate(2013,3,20)
  summer=ISOdate(2013,6,21) 
  autumn=ISOdate(2013,9,22)
  winter=ISOdate(2013,12,21)
           

flights_season <- flights %>% 
  mutate(dep_date=ISOdate(year,month,day))%>%
  mutate(season = case_when(spring<=dep_date & dep_date<summer ~ "spring",
                            summer<=dep_date & dep_date<autumn ~ "summer",
                            autumn<=dep_date & dep_date<winter ~ "autumn",
                            dep_date > autumn | dep_date<spring ~ "winter"    
                            ))


flights_season  %>% 
  ggplot(aes(x=dep_time,color=season)) +
  geom_freqpoly()
```
  
  2.3.3

  
  
  
```{r}
  flights  %>% 
  ggplot(aes(x=arr_delay,color=weekdays(ISOdate(year,month,day)))) +
  geom_freqpoly()+
  xlim(-40,150)

```
```{r}
 


 flights  %>% 
  mutate(delay_length=case_when(arr_delay<60 ~"short",
                                  arr_delay>=60 ~"long"),na.rm=TRUE) %>% 
  ggplot(aes(x=arr_delay,color=weekdays(ISOdate(year,month,day)))) +
  geom_freqpoly()+
  facet_wrap(~delay_length, scales="free")
  
  xlim(-40,150)
```
  
  